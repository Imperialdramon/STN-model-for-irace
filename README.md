# STN-i Model for irace

This repository provides an adaptation of the [Search Trajectory Network (STN)](https://github.com/gabro8a/STNs) model for use with the irace automatic algorithm configuration tool. It enables the construction, analysis, and visualization of STN-i networks based on data from independent irace executions, parameter definitions, and location mappings.

---

## Table of Contents

- Overview
- STN-i
  - 1. Generating STN-i Data (`generate_STN-i_data.R`)
  - 2. Plotting STN-i (`plot_STN-i.R`)
  - 3. Calculating STN-i Metrics (`metrics_STN-i.R`)
- Merged STN-i
  - 4. Merging Multiple STN-i Files (`generate_merged_STN-i_data.R`)
  - 5. Plotting Merged STN-i (`plot_merged_STN-i.R`)
  - 6. Calculating Merged STN-i Metrics (`metrics_merged_STN-i.R`)
- Utilities (`utils.R`)
- References

---

## Overview

- **STN-i** is an adaptation of the original STN model tailored for the irace tuning tool.
- It uses trace files generated by the `irace-STN-R-version` repository, which incorporates parameter and location definitions to build `.RData` files representing STN-i networks.
- This repository supports generating, merging, visualizing, and analyzing STN-i networks, enabling structural insight into irace's search behavior.

---

## STN-i

### 1. Generating STN-i Data (`generate_STN-i_data.R`)

**Purpose:**  
Processes irace trace files to build a Search Trajectory Network (STN-i) for a single configuration scenario.

**Arguments:**

| Parameter               | Required | Description                                                                 |
|------------------------|----------|-----------------------------------------------------------------------------|
| --input                | Yes      | Path to the irace trace file (.txt).                                       |
| --output               | Yes      | Folder where the results will be saved.                                    |
| --output_file          | No       | Name of the output `.RData` file (default: auto-generated).                |
| --problem_type         | No       | "min" (default) or "max".                                                  |
| --best_known_solution  | No       | Optional numeric reference value.                                          |
| --number_of_runs       | No       | Number of runs to include (default: all).                                  |
| --separator            | No       | Separator in the trace file (default: `,`).                                |
| --network_name         | No       | Custom name for the network.                                               |

**Example usage:**

Rscript generate_STN-i_data.R --input=trace.txt --output=results/ --problem_type=min --network_name=MyNetwork

---

### 2. Plotting STN-i (`plot_STN-i.R`)

**Purpose:**  
Generates a PDF visualization of a single STN-i network.

**Arguments:**

| Parameter               | Required | Description                                                                 |
|-------------------------|----------|-----------------------------------------------------------------------------|
| --input                 | Yes      | Path to the STN-i `.RData` file.                                            |
| --output                | Yes      | Output folder for the plot.                                                 |
| --output_file           | No       | Name of the PDF file (default: auto-generated).                             |
| --layout_type           | No       | Graph layout algorithm (default: "fr"). Options include:  
                                        "fr" (Fruchterman-Reingold),  
                                        "kk" (Kamada-Kawai),  
                                        "circle", "grid", "sphere", "random",  
                                        "star", "tree", "reingold",  
                                        "mds", "drl", "lgl",  
                                        "graphopt", "sugiyama", "dh".         |
| --show_regular          | No       | Show regular nodes (default: TRUE).                                         |
| --show_start_regular    | No       | Show start regular nodes (default: FALSE).                                  |
| --size_factor           | No       | Node/edge scaling (default: 1).                                             |
| --palette               | No       | Color palette (1–5, default: 1).                                            |
| --zoom_quantile         | No       | Focus on nodes below a quantile (default: 1, i.e., all nodes).             |

**Example usage:**

Rscript plot_STN-i.R --input=results/my_stn_i.RData --output=plots/ --palette=2 --layout_type=kk

---

### 3. Calculating STN-i Metrics (`metrics_STN-i.R`)

**Purpose:**  
Extracts various metrics from a single STN-i network.

**Arguments:**

| Parameter      | Required | Description                                               |
|----------------|----------|-----------------------------------------------------------|
| --input        | Yes      | Path to the `.RData` file.                                |
| --output       | Yes      | Output folder for CSV file.                               |
| --output_file  | No       | Name of the output file (default: auto-generated).        |

**Metrics include:**

- Number of nodes and edges
- Number of best and end nodes
- Number of connected components
- Strength of best nodes
- Average path length
- Total number of paths to optimal nodes

**Example usage:**

Rscript metrics_STN-i.R --input=results/my_stn_i.RData --output=metrics/

---

## Merged STN-i

### 4. Merging Multiple STN-i Files (`generate_merged_STN-i_data.R`)

**Purpose:**  
Combines multiple STN-i networks into one unified representation.

**Arguments:**

| Parameter      | Required | Description                                                    |
|----------------|----------|----------------------------------------------------------------|
| --input        | Yes      | Folder with 2+ `.RData` STN-i files.                           |
| --output       | Yes      | Output folder for the merged file.                             |
| --output_file  | No       | Name of the merged `.RData` file (default: auto-generated).    |
| --criteria     | No       | How to aggregate values: "mean" (default), "min", or "max".    |

**Example usage:**

Rscript generate_merged_STN-i_data.R --input=results/ --output=merged/ --criteria=mean

---

### 5. Plotting Merged STN-i (`plot_merged_STN-i.R`)

**Purpose:**  
Creates a visualization of a merged STN-i network.

**Arguments:**

| Parameter               | Required | Description                                                        |
|--------------------------|----------|--------------------------------------------------------------------|
| --input                 | Yes      | Path to the merged `.RData` file.                                  |
| --output                | Yes      | Output folder for the PDF.                                         |
| --output_file           | No       | Name of the PDF file (default: auto-generated).                    |
| --layout_type           | No       | Graph layout algorithm (default: "fr"). Options include:  
                                        "fr", "kk", "circle", "grid", "sphere", "random",  
                                        "star", "tree", "reingold", "mds", "drl", "lgl",  
                                        "graphopt", "sugiyama", "dh".                                     |
| --show_shared_regular   | No       | Show shared regular nodes (default: TRUE).                         |
| --show_shared_mixed     | No       | Show shared mixed nodes (default: TRUE).                           |
| --show_regular          | No       | Show regular nodes (default: TRUE).                                |
| --show_start_regular    | No       | Show start regular nodes (default: FALSE).                         |
| --size_factor           | No       | Scale node/edge sizes (default: 1).                                |
| --palette               | No       | Color palette (1–5, default: 1).                                   |
| --zoom_quantile         | No       | Focus on lower-fitness quantile (default: 1).                      |

**Example usage:**

Rscript plot_merged_STN-i.R --input=merged/merged_stn_i.RData --output=plots/ --layout_type=sugiyama

---

### 6. Calculating Merged STN-i Metrics (`metrics_merged_STN-i.R`)

**Purpose:**  
Computes metrics from a merged STN-i object.

**Arguments:**

| Parameter      | Required | Description                                                  |
|----------------|----------|--------------------------------------------------------------|
| --input        | Yes      | Path to the `.RData` merged file.                            |
| --output       | Yes      | Folder to store output metrics.                              |
| --output_file  | No       | Name of the output CSV file (default: auto-generated).       |

**Metrics include:**

- Node and edge statistics
- Shared node counts (regular, mixed, elite)
- Connected components
- Strength and paths to best optima

**Example usage:**

Rscript metrics_merged_STN-i.R --input=merged/merged_stn_i.RData --output=metrics/

---

## Utilities (`utils.R`)

Contains internal helper functions for:

- Parsing arguments
- Coloring and categorizing nodes/edges
- Layout generation and zoom control
- Metrics extraction and CSV export
- General file handling

---

## References

- **Original STN model:**  
  https://github.com/gabro8a/STNs  
  Defines the original concept of Search Trajectory Networks for visualizing and analyzing search spaces.

- **irace-STN-R-version:**  
  https://github.com/Imperialdramon/irace-STN-R-version  
  Repository for generating STN-i-readable files using `raceData`, parameter definitions, and location mappings from irace executions. Serves as the main preprocessing step for this STN-i framework.

- **irace (official repository):**  
  https://github.com/MLopez-Ibanez/irace  
  Main repository of the irace automatic configuration tool, used for tuning algorithm parameters.

- **irace with raceData (custom repository):**  
  https://github.com/Imperialdramon/irace-with-raceData  
  A customized version of irace that stores detailed per-run configuration data (`raceData`), allowing deeper structural analysis via STN-i modeling.
