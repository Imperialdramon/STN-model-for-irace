# STN-i Model for irace

This repository provides an adaptation of the [Search Trajectory Network (STN)](https://github.com/gabro8a/STNs) model for use with the [irace](https://github.com/MLopez-Ibanez/irace) automatic algorithm configuration tool. It enables the construction, analysis, and visualization of STN-i networks based on data from independent irace executions, parameter definitions, and location mappings.

---

## Table of Contents

- [Overview](#overview)
- [STN-i](#stn-i)
  - [1. Generating STN-i Data (`generate_STN-i_data.R`)](#1-generating-stn-i-data-generatestn-i_datar)
  - [2. Plotting STN-i (`plot_STN-i.R`)](#2-plotting-stn-i-plot_stn-ir)
  - [3. Calculating STN-i Metrics (`metrics_STN-i.R`)](#3-calculating-stn-i-metrics-metrics_stn-ir)
- [Merged STN-i](#merged-stn-i)
  - [4. Merging Multiple STN-i Files (`generate_merged_STN-i_data.R`)](#4-merging-multiple-stn-i-files-generate_merged_stn-i_datar)
  - [5. Plotting Merged STN-i (`plot_merged_STN-i.R`)](#5-plotting-merged-stn-i-plot_merged_stn-i-r)
  - [6. Calculating Merged STN-i Metrics (`metrics_merged_STN-i.R`)](#6-calculating-merged-stn-i-metrics-metrics_merged_stn-ir)
- [Utilities (`utils.R`)](#utilities-utilsr)
- [References](#references)

---

## Overview

- **STN-i** is an adaptation of the original [STN model](https://github.com/gabro8a/STNs) tailored for the irace tuning tool.
- It uses trace files generated by [`irace-STN-R-version`](https://github.com/Imperialdramon/irace-STN-R-version), which incorporate parameter and location definitions to build `.RData` files representing STN-i networks.
- This repository supports generating, merging, visualizing, and analyzing STN-i networks to gain structural insights into irace's search behavior.

---

## STN-i

### 1. Generating STN-i Data (`generate_STN-i_data.R`)

**Purpose:**  
Processes irace trace files to build a Search Trajectory Network (STN-i) for a single configuration scenario.

**Arguments:**

| Parameter                | Required | Description                                                                 |
|--------------------------|----------|-----------------------------------------------------------------------------|
| `--input`                | Yes      | Path to the irace trace file (.txt).                                       |
| `--output`               | Yes      | Folder where the results will be saved.                                    |
| `--output_file`          | No       | Name of the output `.RData` file (default: auto-generated).                |
| `--problem_type`         | No       | `"min"` (default) or `"max"`.                                              |
| `--best_known_solution`  | No       | Optional numeric reference value.                                          |
| `--number_of_runs`       | No       | Number of runs to include (default: all).                                  |
| `--separator`            | No       | Separator in the trace file (default: `,`).                                |
| `--network_name`         | No       | Custom name for the network.                                               |

**Example usage:**

```sh
Rscript R/generate_STN-i_data.R --input=trace.txt --output=results/ --problem_type=min --network_name=MyNetwork
```

---

### 2. Plotting STN-i (`plot_STN-i.R`)

**Purpose:**  
Generates a PDF visualization of a single STN-i network.

**Arguments:**

| Parameter               | Required | Description                                                    |
|-------------------------|----------|----------------------------------------------------------------|
| `--input`               | Yes      | Path to the STN-i `.RData` file.                               |
| `--output`              | Yes      | Output folder for the plot.                                    |
| `--output_file`         | No       | Name of the PDF file (default: auto-generated).                |
| `--layout_type`         | No       | Graph layout algorithm (default: `fr`). See layout options.    |
| `--show_regular`        | No       | Show regular nodes (default: `TRUE`).                          |
| `--show_start_regular`  | No       | Show start regular nodes (default: `FALSE`).                   |
| `--size_factor`         | No       | Node/edge scaling factor (default: `1`).                       |
| `--palette`             | No       | Color palette (1–5, default: `1`).                             |
| `--zoom_quantile`       | No       | Focus on nodes below a quantile (default: `1`, all nodes).     |

**Available layout types (`--layout_type`):**

- `fr` – Fruchterman-Reingold (default)
- `kk` – Kamada-Kawai
- `circle` – Circular layout
- `grid` – Grid layout
- `sphere` – Spherical layout
- `random` – Random node placement
- `drl` – DrL (force-directed, scalable)
- `graphopt` – Force-directed using physics model

**Example usage:**

```sh
Rscript R/plot_STN-i.R --input=results/my_stn_i.RData --output=plots/ --layout_type=kk --palette=2
```

---

### 3. Calculating STN-i Metrics (`metrics_STN-i.R`)

**Purpose:**  
Extracts various metrics from a single STN-i network.

**Arguments:**

| Parameter      | Required | Description                                               |
|----------------|----------|-----------------------------------------------------------|
| `--input`      | Yes      | Path to the `.RData` file.                                |
| `--output`     | Yes      | Output folder for CSV file.                               |
| `--output_file`| No       | Name of the output file (default: auto-generated).        |

**Metrics include:**

- Number of nodes and edges  
- Number of best and end nodes  
- Number of connected components  
- Strength of best nodes  
- Average path length  
- Total number of paths to optimal nodes  

**Example usage:**

```sh
Rscript R/metrics_STN-i.R --input=results/my_stn_i.RData --output=metrics/
```

---

## Merged STN-i

### 4. Merging Multiple STN-i Files (`generate_merged_STN-i_data.R`)

**Purpose:**  
Combines multiple STN-i networks into one unified representation.

**Arguments:**

| Parameter      | Required | Description                                                    |
|----------------|----------|----------------------------------------------------------------|
| `--input`      | Yes      | Folder with 2+ `.RData` STN-i files.                           |
| `--output`     | Yes      | Output folder for the merged file.                             |
| `--output_file`| No       | Name of the merged `.RData` file (default: auto-generated).    |
| `--criteria`   | No       | How to aggregate values: `"mean"` (default), `"min"`, `"max"`.|

**Example usage:**

```sh
Rscript R/generate_merged_STN-i_data.R --input=results/ --output=merged/ --criteria=mean
```

---

### 5. Plotting Merged STN-i (`plot_merged_STN-i.R`)

**Purpose:**  
Creates a visualization of a merged STN-i network.

**Arguments:**

| Parameter               | Required | Description                                                    |
|-------------------------|----------|----------------------------------------------------------------|
| `--input`               | Yes      | Path to the merged `.RData` file.                              |
| `--output`              | Yes      | Output folder for the PDF.                                     |
| `--output_file`         | No       | Name of the PDF file (default: auto-generated).                |
| `--layout_type`         | No       | Graph layout algorithm (default: `fr`). See layout options.    |
| `--show_shared_regular` | No       | Show shared regular nodes (default: `TRUE`).                   |
| `--show_shared_mixed`   | No       | Show shared mixed nodes (default: `TRUE`).                     |
| `--show_regular`        | No       | Show regular nodes (default: `TRUE`).                          |
| `--show_start_regular`  | No       | Show start regular nodes (default: `FALSE`).                   |
| `--size_factor`         | No       | Node/edge scaling factor (default: `1`).                       |
| `--palette`             | No       | Color palette (1–5, default: `1`).                             |
| `--zoom_quantile`       | No       | Focus on nodes below a quantile (default: `1`).                |

**Available layout types (`--layout_type`):**

Same as in [Plotting STN-i](#2-plotting-stn-i-plot_stn-ir)

**Example usage:**

```sh
Rscript R/plot_merged_STN-i.R --input=merged/merged_stn_i.RData --output=plots/ --layout_type=sugiyama
```

---

### 6. Calculating Merged STN-i Metrics (`metrics_merged_STN-i.R`)

**Purpose:**  
Computes metrics for a merged STN-i object.

**Arguments:**

| Parameter      | Required | Description                                               |
|----------------|----------|-----------------------------------------------------------|
| `--input`      | Yes      | Path to the `.RData` merged file.                         |
| `--output`     | Yes      | Folder to store output metrics.                           |
| `--output_file`| No       | Name of the output CSV file (default: auto-generated).    |

**Metrics include:**

- Node and edge statistics  
- Shared node breakdowns (regular, mixed, elite)  
- Connected components  
- Strength and paths to best optima  

**Example usage:**

```sh
Rscript R/metrics_merged_STN-i.R --input=merged/merged_stn_i.RData --output=metrics/
```

---

## Utilities (`utils.R`)

Provides core internal functions:

- Command-line argument parsing  
- Node/edge categorization and decoration  
- Layout selection and zooming  
- Palette and style handling  
- Metric calculation and CSV exporting  
- File management helpers  

---

## References

- **Original STN model**  
  https://github.com/gabro8a/STNs

- **irace-STN-R-version**  
  https://github.com/Imperialdramon/irace-STN-R-version  
  Repository for generating STN-i-readable files using `raceData`, parameter definitions, and location mappings from irace executions.

- **irace (official repository)**  
  https://github.com/MLopez-Ibanez/irace

- **irace with raceData (custom repository)**  
  https://github.com/Imperialdramon/irace-with-raceData  
  A customized version of irace that stores detailed per-run configuration data (`raceData`), allowing deeper structural analysis via STN-i modeling.
